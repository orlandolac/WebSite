<link media="screen" rel="stylesheet" type="text/css" href="/temas/default/default/css/com-formulario.css" />
<style>
    .CTRLV{
        font-style: italic;
        color: #ccc;
    }
</style>

<script type="text/javascript" language="javascript" src="/scripts/alex/campo.js"></script>
<script type="text/javascript" language="javascript" src="/scripts/alex/filtro.js"></script>
<script type="text/javascript" language="javascript">
    $(window).keydown(function(e){
        if(e.ctrlKey){
            if(e.keyCode == 86){
                cp = document.activeElement;
                if(cp.name == 'link'){
                    $(cp).attr('value', '');
                    $(cp).removeAttr('readonly');
                }
            }
        }
    });
    $(window).keyup(function(e){
        f = document.formulario;
        $(f.link).attr('readonly', 'readonly');
        dica = 'Utilize Ctrl+V para preencher.';
        if($(f.link).attr('value').length < 1 || $(f.link).attr('value') == dica){
            $(f.link).attr('value', dica);
            $(f.link).addClass('CTRLV');
        }else{
            $(f.link).removeClass('CTRLV');
        }
    });
    function carregar(link){
        if(link.value.length > 10 && link.value != 'Utilize Ctrl+V para preencher.'){
            document.getElementById('FORMULARIO').innerHTML = '<div class="LOADING-ESPECIFICO"></div>';
            $.post('/noticias/ajax-noticias-add-load/id/0', {
                'url': link.value
            }, function(data){
                document.getElementById('FORMULARIO').innerHTML = data.toString();
                document.getElementById('TABELA_RELACAO').style.display = 'block';
                document.getElementById('TABLE_DESTINO').appendChild(document.getElementById('TABELA_RELACAO'));
            }, 'html');
        }else{
            marcaCampoErro(link);
        }
    }
    function salvar(){
        erro = 0;
        f = document.formulario;
        if(!(f.noticia_data_dia.value > 0)){
            marcaCampoErro(f.noticia_data_dia); erro++;
        }
        if(!(f.noticia_data_mes.value > 0)){
            marcaCampoErro(f.noticia_data_mes); erro++;
        }
        if(!(f.noticia_data_ano.value > 0)){
            marcaCampoErro(f.noticia_data_ano); erro++;
        }
        if(f.noticia_pessoas.options.length > 0 || f.noticia_partidos.options.length > 0){
        }else{
            marcaCampoErro(f.noticia_pessoas); erro++;
            marcaCampoErro(f.noticia_pessoas_search); erro++;
            marcaCampoErro(f.noticia_partidos); erro++;
            marcaCampoErro(f.noticia_partidos_search); erro++;
        }
        
        noticia_temas = new Array();
        temas = document.getElementsByName('noticia_temas');
        for(t=0; t<temas.length; t++){
            tema = temas.item(t);
            if(tema.checked){
                noticia_temas[noticia_temas.length] = tema.value;
            }
        }
        if(noticia_temas.length < 1){
            alert('Escolha no mínimo UM tema.');
        }else if(noticia_temas.length > 3){
            alert('Escolha no máximo TRÊS temas.');
        }else{
            if(erro==0){
                noticia_pessoas = new Array();
                for(c=0; c<f.noticia_pessoas.options.length; c++){
                    noticia_pessoas[noticia_pessoas.length] = f.noticia_pessoas.options[c].value*1;
                }
                noticia_partidos = new Array();
                for(c=0; c<f.noticia_partidos.options.length; c++){
                    noticia_partidos[noticia_partidos.length] = f.noticia_partidos.options[c].value*1;
                }

                $.post('/noticias/ajax-noticias-add-salvar/id/0', {
                    'noticia_data': f.noticia_data.value,
                    'noticia_data_dia': f.noticia_data_dia.value,
                    'noticia_data_mes': f.noticia_data_mes.value,
                    'noticia_data_ano': f.noticia_data_ano.value,
                    'noticia_link': f.noticia_link.value,
                    'noticia_dominio': f.noticia_dominio.value,
                    'noticia_titulo': f.noticia_titulo.value,
                    'noticia_descricao': f.noticia_descricao.value,
                    'noticia_palavra_chave': f.noticia_palavra_chave.value,
                    'noticia_imagem': f.noticia_imagem.value,
                    'noticia_temas': noticia_temas,
                    'noticia_pessoas': noticia_pessoas,
                    'noticia_partidos': noticia_partidos
                }, function(data){
                    carregarAjaxOculto('/index/ajax-mensagem', 'MENSAGENS');
                    desligaDialogo();
                }, 'html');
            }
        }
    }
</script>
            
<div class="CONTEINER-DIALOGO">
    <div class="POPUP" style="width:730px;margin-left:-365px">
        <div class="ppClose"><div class="botao" onclick="desligaDialogo()">x</div></div>
        <div class="ppTitulo">Adicionar Notícia</div>
        <div class="ppCorpo">
            <div style="margin: 10px">
                Antes de salvar, lembre-se sempre das <a href="/sobre-nos/politicas-e-termos#sobre-as-noticias"><b><u>políticas e termos</u></b></a>
                com os quais você se comprometeu no momento do cadastro. Como regra geral,
                alertamos, haverá punição para quem usar este recurso de maneira inadequada.
            </div>
            
            <form class="FORMULARIO" id="FORMULARIO" name="formulario" action="/contato" method="post" >
                <center>
                    <table>
                        <tr><th><div class="DICA-ICONE">
                                    <div class="DICA">
                                        <div class="corpo">
                                            <div class="topico">Campo obrigatório.</div>
                                            <div class="texto">Copie (Ctrl+C) o LINK da pagina que contém a notícia e cole (Ctrl+V) neste campo, após selecioná-lo.</div>
                                        </div>
                                        <div class="seta"></div>
                                    </div>
                                </div>Link da Página
                            </th>
                            <td><input readonly value="Utilize Ctrl+V para preencher." onclick="desmarcaCampo(this)" onkeypress="desmarcaCampo(this)" name="link" maxlength="255" autocomplete="off" type="text" class="Text CTRLV" ></td>
                        </tr>
                        <tr><td class="opcoes" colspan="2">
                                <a class="alex-bt destaque verde-minimo" onclick="carregar(document.formulario.link)">Carregar</a>
                            </td>
                        </tr>
                    </table>
                </center>
            </form>
            
            <table id="TABELA_RELACAO" style="display:none">
                <tr><th style="text-align: left; padding-left: 10px">Pessoas
                        <div class="DICA-ICONE" style="float: right">
                            <div class="DICA">
                                <div class="corpo">
                                    <div class="topico">Campo obrigatório.</div>
                                    <div class="texto">Escreve o Nome, Título de Eleitor ou CPF da pessoa e depois a selecione na lista que surgirá para relacioná-la a notícia.</div>
                                    <div class="topico">Para removê-la da relação clique em seu nome na lista a baixo.</div>
                                </div>
                                <div class="seta"></div>
                            </div>
                        </div>
                    </th>
                    <td><div class="ListaSelect" id="noticia_pessoas_search_lista">
                            <div class="corpo">
                                <div class="scroll" id="noticia_pessoas_search_scroll">
                                    <div id="noticia_pessoas_search_page">
                                        <div class="item">
                                            <div class="texto">
                                                <div class="descricao">Escreva o nome da pessoa neste campo.</div>
                                                <div class="descricao"><br/>Você também pode buscar pessoas com:</div>
                                                <div class="descricao">&Gt; os 12 números do Título de Eleitor;</div>
                                                <div class="descricao">&Gt; os 11 números do CPF; ou</div>
                                                <div class="descricao">&Gt; o código no OPovoUnido.com</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input id="noticia_pessoas_search" name="noticia_pessoas_search" onclick="desmarcaCampo(this);desmarcaCampo(document.formulario.noticia_pessoas)" maxlength="100" type="text" class="Text" ><br/>
                        <select id="noticia_pessoas" name="noticia_pessoas" class="multiple" multiple disabled style="margin:-2px 0 0 0; background: #fff; height: 54px; width: 100%" size="2">
                            <?php
                            if(isset($this->pessoa)){
                                echo '<option onclick="this.remove()" title="' . $this->pessoa['pessoa_nome'] . '" value="' . $this->pessoa['pessoa_id'] . '">' . $this->pessoa['pessoa_nome'] . '</option>';
                            }
                            ?>
                        </select>
                    </td>
                </tr>
                <tr><th style="text-align: left; padding-left: 10px">Partidos
                        <div class="DICA-ICONE" style="float: right">
                            <div class="DICA">
                                <div class="corpo">
                                    <div class="topico">Campo obrigatório.</div>
                                    <div class="texto">Escreve o Nome, Sigla ou Número do partido e depois o selecione na lista que surgirá para relacioná-lo a notícia.</div>
                                    <div class="topico">Para removê-lo da relação clique em seu nome na lista a baixo.</div>
                                </div>
                                <div class="seta"></div>
                            </div>
                        </div>
                    </th>
                    <td><div class="ListaSelect" id="noticia_partidos_search_lista">
                            <div class="corpo">
                                <div class="scroll" id="noticia_partidos_search_scroll">
                                    <div id="noticia_partidos_search_page">
                                        <div class="item">
                                            <div class="texto">
                                                <div class="descricao">Escreva o nome do partido neste campo.</div>
                                                <div class="descricao"><br/>Você também pode buscar partidos com:</div>
                                                <div class="descricao">&Gt; a sigla;</div>
                                                <div class="descricao">&Gt; o número; ou</div>
                                                <div class="descricao">&Gt; o código no OPovoUnido.com</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input id="noticia_partidos_search" name="noticia_partidos_search" onclick="desmarcaCampo(this);desmarcaCampo(document.formulario.noticia_partidos)" maxlength="100" type="text" class="Text" ><br/>
                        <select id="noticia_partidos" name="noticia_partidos" class="multiple" multiple disabled style="margin:-2px 0 0 0; background: #fff; height: 54px; width: 100%" size="2">
                            <?php
                            if(isset($this->partido)){
                                echo '<option onclick="this.remove()" title="' . $this->partido['partido_nome'] . '" value="' . $this->partido['partido_id'] . '">' . $this->partido['partido_nome'] . '</option>';
                            }
                            ?>
                        </select>
                    </td>
                </tr>
                <tr><th style="text-align: left; padding-left: 10px">Publicação
                        <div class="DICA-ICONE" style="float: right">
                            <div class="DICA">
                                <div class="corpo">
                                    <div class="topico">Campo obrigatÃ³rio.</div>
                                    <div class="texto">Encontre a data da publicaÃ§Ã£o da notÃ­cia em sua pÃ¡gina e utilize os campos a seguir para formar a mesma data.</div>
                                    <div class="topico">Ex: 17/11/1989.</div>
                                </div>
                                <div class="seta"></div>
                            </div>
                        </div>
                    </th>
                    <td><select onclick="desmarcaCampo(this)" name="noticia_data_dia" style="width: 100px">
                            <option value="0"></option>
                            <?php
                            for($i=1; $i<32; $i++) {
                                echo '<option value="' . $i . '">' . $i . '</option>';
                            }
                            ?>
                        </select>
                        <select onclick="desmarcaCampo(this)" name="noticia_data_mes" style="width: 164px">
                            <option value="0"></option>
                            <?php
                            for($i=1; $i<13; $i++) {
                                echo '<option value="' . $i . '">' . Alex_Util::mes($i) . '</option>';
                            }
                            ?>
                        </select>
                        <select onclick="desmarcaCampo(this)" name="noticia_data_ano" style="width: 100px">
                            <option value="0"></option>
                            <?php
                            for($i=date('Y'); $i>date('Y')-130; $i--) {
                                echo '<option value="' . $i . '">' . $i . '</option>';
                            }
                            ?>
                        </select>
                    </td>
                </tr>
            </table>
        </div>
        <div class="ppOpcoes"><a> </a></div>
    </div>
</div>

<script>
    $('#noticia_pessoas_search').focus(function(){
        $('#noticia_pessoas_search_lista').css({
            opacity: 1,
            visibility: 'visible'
        });
    });
    $('#noticia_pessoas_search').blur(function(){
        $('#noticia_pessoas_search_lista').css({
            opacity: 0,
            visibility: 'hidden'
        });
    });
    var jQPaginaStatusAddPessoa = 0;
    var jQPaginaAtualAddPessoa = 1;
    $('#noticia_pessoas_search').keyup(function(){
        if(jQPaginaStatusAddPessoa == 0){
            $('#noticia_pessoas_search_lista').css({
                opacity: 1,
                visibility: 'visible'
            });
            if($('#noticia_pessoas_search').attr('value').length > 0){
                if($('#noticia_pessoas_search').attr('value').length > 2 || ( !isNaN($('#noticia_pessoas_search').attr('value')) && $('#noticia_pessoas_search').attr('value') % 1 == 0)){
                    jQPaginaStatusAddPessoa = 1;
                    jQPaginaAtualAddPessoa = 1;
                    $.post('/dossies/ajax-paginacao-add/id/0', {
                        'pagina': jQPaginaAtualAddPessoa,
                        'palavra-chave': $('#noticia_pessoas_search').attr('value')
                    }, function(data){
                        document.getElementById('noticia_pessoas_search_page').innerHTML = data.toString();
                        $('#noticia_pessoas_search_scroll').animate({scrollTop: 0}, 500);
                        jQPaginaStatusAddPessoa = 0;
                    }, 'html');
                }
            }
        }
    });
    $('#noticia_pessoas_search_scroll').bind('scroll', function(){
        if(document.getElementById('fim-da-lista-pessoas')){
            if(jQPaginaStatusAddPessoa == 0 && jQPaginaAtualAddPessoa < document.getElementById('fim-da-lista-pessoas').value){
                if(($(this).scrollTop() + $(this).height() + 50) > $('#noticia_pessoas_search_page').height()){
                    jQPaginaStatusAddPessoa = 1;
                    $.post('/dossies/ajax-paginacao-add/id/0', {
                        'pagina': ++jQPaginaAtualAddPessoa,
                        'palavra-chave': $('#noticia_pessoas_search').attr('value')
                    }, function(data){
                        document.getElementById('noticia_pessoas_search_page').innerHTML += data.toString();
                        jQPaginaStatusAddPessoa = 0;
                    }, 'html');
                }
            }
        }
    });
    
    $('#noticia_partidos_search').focus(function(){
        $('#noticia_partidos_search_lista').css({
            opacity: 1,
            visibility: 'visible'
        });
    });
    $('#noticia_partidos_search').blur(function(){
        $('#noticia_partidos_search_lista').css({
            opacity: 0,
            visibility: 'hidden'
        });
    });
    var jQPaginaStatusAddPartido = 0;
    var jQPaginaAtualAddPartido = 1;
    $('#noticia_partidos_search').keyup(function(){
        if(jQPaginaStatusAddPartido == 0){
            $('#noticia_partidos_search_lista').css({
                opacity: 1,
                visibility: 'visible'
            });
            if($('#noticia_partidos_search').attr('value').length > 0){
                if($('#noticia_partidos_search').attr('value').length > 1 || ( !isNaN($('#noticia_partidos_search').attr('value')) && $('#noticia_partidos_search').attr('value') % 1 == 0)){
                    jQPaginaStatusAddPartido = 1;
                    jQPaginaAtualAddPartido = 1;
                    $.post('/partidos/ajax-paginacao-add/id/0', {
                        'pagina': jQPaginaAtualAddPartido,
                        'palavra-chave': $('#noticia_partidos_search').attr('value')
                    }, function(data){
                        document.getElementById('noticia_partidos_search_page').innerHTML = data.toString();
                        $('#noticia_partidos_search_scroll').animate({scrollTop: 0}, 500);
                        jQPaginaStatusAddPartido = 0;
                    }, 'html');
                }
            }
        }
    });
    $('#noticia_partidos_search_scroll').bind('scroll', function(){
        if(document.getElementById('fim-da-lista-partidos')){
            if(jQPaginaStatusAddPartido == 0 && jQPaginaAtualAddPartido < document.getElementById('fim-da-lista-partidos').value){
                if(($(this).scrollTop() + $(this).height() + 50) > $('#noticia_partidos_search_page').height()){
                    jQPaginaStatusAddPartido = 1;
                    $.post('/partidos/ajax-paginacao-add/id/0', {
                        'pagina': ++jQPaginaAtualAddPartido,
                        'palavra-chave': $('#noticia_partidos_search').attr('value')
                    }, function(data){
                        document.getElementById('noticia_partidos_search_page').innerHTML += data.toString();
                        jQPaginaStatusAddPartido = 0;
                    }, 'html');
                }
            }
        }
    });
    
    function itemAdd(select, valor, texto){
        if(select == 'noticia_pessoas'){
            $('#noticia_pessoas').append($('<option onclick="this.remove()" title="'+texto+'" value="'+valor+'">'+texto+'</option>'));
        }
        if(select == 'noticia_partidos'){
            $('#noticia_partidos').append($('<option onclick="this.remove()" title="'+texto+'" value="'+valor+'">'+texto+'</option>'));
        }
    }
</script>